# Windows定时任务设置详细指南

## 🎯 什么是定时任务？

**定时任务**是Windows系统的一个功能，可以让电脑在指定时间自动执行某个程序，就像设置一个"智能闹钟"。

**为什么需要定时任务？**
- 金融数据每天都会更新
- 不可能每天手动更新数据
- 确保用户始终看到最新数据
- 自动化运维，减少人工操作

## 🔧 设置方法一：使用批处理脚本（推荐）

### 第一步：运行设置脚本

```bash
# 双击运行
setup_scheduler.bat
```

这个脚本会自动创建定时任务，你只需要双击运行即可。

### 第二步：验证任务创建

```bash
# 在命令提示符中运行
schtasks /query /tn "AGIX Fund Monitor 数据更新"
```

## 🔧 设置方法二：手动设置（详细步骤）

### 第一步：打开任务计划程序

**方法1：通过搜索**
1. 按 `Win + S` 打开搜索
2. 输入 "任务计划程序"
3. 点击 "任务计划程序"

**方法2：通过运行**
1. 按 `Win + R` 打开运行
2. 输入 `taskschd.msc`
3. 按回车

### 第二步：创建基本任务

1. **在右侧面板点击 "创建基本任务"**
2. **输入任务信息：**
   - 名称：`AGIX Fund Monitor 数据更新`
   - 描述：`每日自动更新AGIX基金监控数据`
3. **点击 "下一步"**

### 第三步：设置触发器

1. **选择 "每天"**
2. **点击 "下一步"**
3. **设置开始时间：**
   - 开始：`09:00:00`
   - 重复任务：`每天`
4. **点击 "下一步"**

### 第四步：设置操作

1. **选择 "启动程序"**
2. **点击 "下一步"**
3. **程序或脚本：** `python`
4. **添加参数：** `auto_update.py --full-update`
5. **起始于：** `C:\Users\18613\Desktop\cursor\FundsMonitor-MVP\v3`
6. **点击 "下一步"**

### 第五步：完成设置

1. **检查设置摘要**
2. **勾选 "当单击完成时，打开此任务属性的对话框"**
3. **点击 "完成"**

### 第六步：高级设置（可选）

在任务属性对话框中：

1. **常规选项卡：**
   - 勾选 "使用最高权限运行"
   - 选择 "不管用户是否登录都要运行"

2. **条件选项卡：**
   - 勾选 "只有在计算机使用交流电源时才启动此任务"
   - 勾选 "如果计算机处于睡眠状态，则将其唤醒"

3. **设置选项卡：**
   - 勾选 "允许按需运行任务"
   - 勾选 "如果任务运行时间超过以下时间，则停止任务"（设置为30分钟）

4. **点击 "确定" 保存设置**

## 📋 任务管理命令

### 查看任务状态
```bash
schtasks /query /tn "AGIX Fund Monitor 数据更新"
```

### 立即运行任务
```bash
schtasks /run /tn "AGIX Fund Monitor 数据更新"
```

### 删除任务
```bash
schtasks /delete /tn "AGIX Fund Monitor 数据更新" /f
```

### 修改任务
```bash
schtasks /change /tn "AGIX Fund Monitor 数据更新" /tr "python C:\path\to\auto_update.py --full-update"
```

## ⏰ 时间设置建议

### 推荐时间设置

**上午9:00（推荐）**
- 美股收盘后，数据最完整
- 用户开始工作前，数据已更新
- 避免网络高峰期

**其他可选时间**
- 上午8:00：更早更新，但数据可能不完整
- 上午10:00：用户工作时间，但数据更完整
- 下午6:00：美股开盘前，数据最新

### 考虑因素

1. **数据可用性**：确保数据源已更新
2. **网络状况**：避免网络高峰期
3. **用户习惯**：用户何时开始使用应用
4. **系统负载**：避免系统繁忙时段

## 🔍 故障排除

### 问题1：任务不执行

**可能原因：**
- Python路径不正确
- 工作目录不正确
- 权限不足

**解决方案：**
```bash
# 检查Python路径
where python

# 检查工作目录
cd C:\Users\18613\Desktop\cursor\FundsMonitor-MVP\v3
dir auto_update.py

# 手动测试脚本
python auto_update.py --full-update
```

### 问题2：任务执行失败

**查看任务历史：**
1. 打开任务计划程序
2. 找到任务
3. 右键选择"属性"
4. 查看"历史记录"选项卡

**检查日志文件：**
```bash
# 查看自动化更新日志
type auto_update.log
```

### 问题3：权限问题

**解决方案：**
1. 以管理员身份运行任务计划程序
2. 在任务属性中勾选"使用最高权限运行"
3. 确保用户账户有足够权限

## 📊 监控和维护

### 监控任务执行

**方法1：查看任务历史**
1. 任务计划程序 → 任务 → 历史记录

**方法2：查看日志文件**
```bash
# 查看更新日志
tail -f auto_update.log
```

**方法3：检查Git提交**
```bash
# 查看最近的自动提交
git log --oneline -10
```

### 定期维护

**每周检查：**
1. 任务是否正常执行
2. 数据是否正确更新
3. 应用是否正常运行
4. 日志文件大小

**每月维护：**
1. 清理旧日志文件
2. 检查磁盘空间
3. 更新Python依赖
4. 备份重要数据

## 🎯 最佳实践

### 1. 时间设置
- 选择数据最完整的时间
- 避免系统繁忙时段
- 考虑用户使用习惯

### 2. 错误处理
- 设置任务超时时间
- 配置重试机制
- 记录详细日志

### 3. 监控告警
- 定期检查任务状态
- 设置失败通知
- 监控系统资源

### 4. 备份策略
- 定期备份任务配置
- 保存重要日志
- 准备恢复方案

## 📞 技术支持

如果遇到问题：

1. **查看日志文件**：`auto_update.log`
2. **检查任务历史**：任务计划程序
3. **手动测试脚本**：`python auto_update.py --full-update`
4. **联系技术支持**

---

**记住：** 定时任务设置好后，你的应用就会每天自动更新数据，用户始终能看到最新信息！ 